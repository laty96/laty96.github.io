webpackJsonp([3],{FbxS:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});s("woOf");var i=s("Xxa5"),n=s.n(i),o=s("exGp"),r=s.n(o),a=s("BO1k"),l=s.n(a),u=s("Dd8w"),c=s.n(u),d=s("bOdI"),h=s.n(d),m=s("KMaP"),g=(s("PJh5"),s("Hvsy")),p=(s("Qfbh"),s("lHQJ")),f=s("NYxO"),v=s("yp89"),y=s("P9fp"),I={name:"UserList",computed:c()({},Object(f.c)({unsub:function(e){return e.postView.unsubPost},post:function(e){return e.postView.post},userInfo:function(e){return e.auth.userInfo},getUserStatus:function(e){return e.auth.userInfo.status},getUsername:function(e){return e.auth.userInfo.name},notify:function(e){return e.auth.notify?e.auth.notify:[]},inactiveNotify:function(e){return e.auth.inactiveNoti?e.auth.inactiveNoti:[]},chatList:function(e){return e.chat.chatList},pendingRequests:function(e){return e.auth.pendingRequests},friendNotify:function(e){return e.auth.friendNotify},converList:function(e){return e.chat.converList},joinedGroupList:function(e){return e.group.joinedGroupList},groupUserList:function(e){return e.group.groupUserList}})),data:function(){return{groupId:"",groupChatId:"",route:"",isMobile:v.e.any(),wh:window.innerHeight+"px",group:""}},props:{userList:Array},watch:{userInfo:function(e,t){this.$store.dispatch("getAllUserWithConversation",this.userInfo.id),this.$store.dispatch("getAllJoinedGroup",this.userInfo._id)},$route:function(e,t){var s=this;this.groupId=e.params.id,this.route=e.name,this.group=this.joinedGroupList.filter(function(e){return e.groupId==s.$route.params.id}),this.$store.dispatch("getAllGroupUser",this.group[0].membersId)},converList:function(e){}},beforeMount:function(){},created:function(){var e=this;this.group=this.joinedGroupList.filter(function(t){return t.groupId==e.$route.params.id}),this.$store.dispatch("getAllGroupUser",this.group[0].membersId),console.log(this.group,this.groupUserList)},mounted:function(){$("#listChat").bootstrapMaterialDesign(),Object(v.h)(document.getElementById("userList"),function(e){"right"==e&&(document.getElementById("userList").style.right="-100%")})},methods:{countNew:function(e){for(var t=0,s=e.content.length-1;s>=0;s--)e.content[s].owner!=this.userInfo.name&&t++;return t},openConversation:function(e){},openMenu:function(){"-100%"==document.getElementById("userList").style.right?(document.getElementById("menu-overlay").classList.add("menu-overlay"),document.getElementById("userList").style.right="0"):(document.getElementById("menu-overlay").classList.remove("menu-overlay"),document.getElementById("userList").style.right="-100%")},createConversation:function(e){var t=this;this.$store.dispatch("CREATE_CONVERSATION",{u:e,userInfo:this.userInfo}).then(function(){t.chatList.forEach(function(s){var i=e.id+t.userInfo.id;s.membersId.indexOf(i)>=0&&($('a[href="#/personal"]').click(),t.$router.push("/personal/"+s.groupId))})})},blockUser:function(e){this.$store.dispatch("BLOCK_USER",{id:this.userInfo.id,userId:e})},unblockUser:function(e){this.$store.dispatch("UNBLOCK_USER",{id:this.userInfo.id,userId:e})},removeFromGroup:function(e){this.$store.dispatch("removeFromGroup",{id:e,groupId:this.group[0].groupId})}}},w={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"chat-list bg-secondary p-0",class:{"hide-user col-8":e.isMobile},style:"overflow:hidden auto",attrs:{id:"userList"}},[s("div",{staticClass:"container-fluid p-0"},e._l(e.groupUserList,function(t){return s("div",{key:t.id,staticClass:"list-group p-0 dropdown",staticStyle:{"min-width":"200px"}},[s("a",{staticClass:"list-group-item list-group-item-action p-1 m-1 rounded text-white",attrs:{role:"button",id:t._id,"data-toggle":"dropdown","aria-haspopup":"false","aria-expanded":"false"}},[s("img",{staticClass:"rounded-circle",staticStyle:{height:"30px",width:"30px"},attrs:{src:t.imgURL}}),e._v("\n        "+e._s(t.name)+"\n      ")]),e._v(" "),s("div",{staticClass:"dropdown-menu",attrs:{"aria-labelledby":t._id}},[t._id!=e.userInfo._id?s("a",{staticClass:"dropdown-item",on:{click:function(s){return e.createConversation(t)}}},[e._v("Message")]):e._e(),e._v(" "),t._id==e.userInfo._id||e.userInfo.blockedUser.includes(t._id)?e._e():s("a",{staticClass:"dropdown-item",attrs:{"data-toggle":"snackbar","data-content":"Blocked "+t.name,"data-html-allowed":"true","data-timeout":"0"},on:{click:function(s){return e.blockUser(t._id)}}},[e._v("Block")]),e._v(" "),t._id!=e.userInfo._id&&e.userInfo.blockedUser.includes(t._id)?s("a",{staticClass:"dropdown-item",attrs:{"data-toggle":"snackbar","data-content":"Unblocked "+t.name,"data-html-allowed":"true","data-timeout":"0"},on:{click:function(s){return e.unblockUser(t._id)}}},[e._v("Unblock")]):e._e(),e._v(" "),t._id==e.userInfo._id?s("router-link",{staticClass:"dropdown-item",attrs:{to:"/profile"}},[e._v("Profile")]):e._e(),e._v(" "),t._id!=e.userInfo._id?s("router-link",{staticClass:"dropdown-item",attrs:{to:"/profile/"+t._id}},[e._v("Profile")]):e._e(),e._v(" "),e.userInfo._id==e.group[0].ownerId&&t._id!=e.userInfo._id?s("a",{staticClass:"dropdown-item",on:{click:function(s){return e.removeFromGroup(t._id)}}},[e._v("Remove from group")]):e._e()],1)])}),0)])},staticRenderFns:[]};var b=s("VU/8")(I,w,!1,function(e){s("eKXm")},"data-v-4995cf85",null).exports,L={name:"Group",components:{Picker:m.Picker,ChatMessage:y.a,UserList:b},props:["id"],data:function(){return h()({isMobile:v.e.any(),messages:{},groupId:this.$route.params.id,chat:[],minimize:!1,isFocus:!0,message:"",newMessages:[],oldMessages:[],emojiPicker:!1,emojiRegex:/(:[^\s]*(?:::[^:\s]*)*[^:\s]:)|(:[^\s]*(?:::[^:\s]*)*[^:\s])/g,emojiRegex2:/:\w{2,}:/g,matchesEmoji:[],emo:"",images:[],files:[],canSendMessage:!0,hasImage:!1,hasFile:!1,paths:[],filePaths:[],realImage:[],realFile:[],imgURL:[],filelimit:20,converlength:0,isScrollable:!1,now:0,limitMessage:30,messageLimit:1e3},"now",Date.now())},computed:c()({},Object(f.c)({userInfo:function(e){return e.auth.userInfo},getUserStatus:function(e){return e.auth.userInfo.status},getUsername:function(e){return e.auth.userInfo.name},notify:function(e){return e.auth.notify?e.auth.notify:[]},inactiveNotify:function(e){return e.auth.inactiveNoti?e.auth.inactiveNoti:[]},joinedGroupList:function(e){return e.group.joinedGroupList},pendingRequests:function(e){return e.auth.pendingRequests},friendNotify:function(e){return e.auth.friendNotify},groupMessage:function(e){return e.group.groupMessage},imgURLs:function(e){return e.chat.imgURL}})),watch:{id:function(){var e=this;this.messages=this.joinedGroupList.filter(function(t){return t.groupId==e.id})[0]||{},console.log()},$route:function(e){var t=this.$route.params.id;this.groupId=t,this.getOldMessage(t),this.getNewMessage(t)},imgURLs:function(e,t){console.log(e,t),e.length==this.images.length&&this.send()}},methods:{calendarTime:v.b,selectEmoji:function(e){document.getElementById("comment").innerHTML+=twemoji.parse(twemoji.convert.fromCodePoint(e.unified))+'<div style="display: none">'+e.colons+"</div>",this.emojiPicker=!1,this.setCaret()},searchEmoji:function(e){if(this.message=document.getElementById("comment").innerText,this.message.length>2&&32==e.keyCode||13==e.keyCode){this.emo=this.message.match(this.emojiRegex);var t=this.emo?this.emo[this.emo.length-1].substr(1):"";t.length>1&&(this.matchesEmoji=m.emojiIndex.search(t).map(function(e){return e}),this.replaceEmoji())}},replaceEmoji:function(e){var t=document.getElementById("comment");if(e){this.message=t.innerHTML;var s=twemoji.parse(twemoji.convert.fromCodePoint(e.unified));t.innerHTML=this.message.replace(this.emo,s+'<div style="display: none">'+e.colons+"</div>"),this.setCaret(),this.matchesEmoji=[],this.emo=[]}else if(this.matchesEmoji.length){this.message=t.innerHTML;var i=twemoji.parse(twemoji.convert.fromCodePoint(this.matchesEmoji[0].unified));t.innerHTML=this.message.replace(this.emo,i+'<div style="display: none">'+this.matchesEmoji[0].colons+"</div>"),this.setCaret(),this.matchesEmoji=[],this.emo=[]}},onDragover:function(){return $("#dropzonebg").addClass("show"),console.log(1),!1},onDragend:function(){return $("#dropzonebg").removeClass("show"),console.log(2),!1},onDrop:function(e){$("#dropzonebg").removeClass("show"),console.log(e),e.preventDefault();var t=e.originalEvent.dataTransfer.files[0],s=new FileReader;return s.onload=function(e){console.log(e.target.result)},console.log(t),s.readAsDataURL(t),!1},chooseImage:function(e){var t=$("#inputImage").get(0).files,s=[],i=!0,n=!1,o=void 0;try{for(var r,a=l()(t);!(i=(r=a.next()).done);i=!0){var u=r.value;if(u.size<5e6){if("image/png"==u.type||"image/jpeg"==u.type||"image/gif"==u.type){new FileReader;this.realImage.push(u),this.images.push(window.URL.createObjectURL(u));var c=this.messages.groupId+"/"+Date.now()+"_"+t[0].name;this.paths.push(c)}}else s.push(u.name)}}catch(e){n=!0,o=e}finally{try{!i&&a.return&&a.return()}finally{if(n)throw o}}s.length&&this.oversize("YOUR IMAGE IS TO BIG","Try other image or reduce image size.\n \n          <p>Images: <code>"+s+"</code></p>")},dropImage:function(e){e.preventDefault(),e.stopPropagation();var t=e.dataTransfer.files;if(t.length){t.length>=this.limitFiles&&alert("Limit"+this.limitFiles+"files");for(var s=0;s<t.length;s++)if("image/jpeg"!=t[s].type&&"image/png"!=t[s].type){var i=this.messages.groupId+"/"+Date.now()+"_"+t[s].name;this.canSendMessage=!1,this.hasFile=!0,this.filePaths.push(i),this.realFile.push(t[s])}else if("image/jpeg"==t[s].type||"image/png"==t[s].type){this.canSendMessage=!1,this.hasImage=!0;var n=this.messages.groupId+"/"+Date.now()+"_"+t[s].name;this.paths.push(n),this.images.push(window.URL.createObjectURL(t[s])),this.realImage.push(t[s])}}this.dragLeave(e)},uploadFile:function(){var e=r()(n.a.mark(function e(t,s,i){return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.$store.dispatch(p.i,{file:t,path:s,id:i}),e.next=3,this.$store.state.chat.files[i];case 3:return this.files=e.sent,e.next=6,this.$store.state.chat.fileCount;case 6:e.sent,console.log(this.files);case 8:case"end":return e.stop()}},e,this)}));return function(t,s,i){return e.apply(this,arguments)}}(),pasteImage:function(e){var t=this.messages.groupId;e.preventDefault();var s=e.clipboardData.files;if(s.length){var i=t+"/"+Date.now()+"_"+s[0].name;this.paths.push(i),this.images.push(window.URL.createObjectURL(s[0])),this.realImage.push(s[0])}var n=(e.originalEvent||e).clipboardData.getData("text/plain");document.execCommand("insertHTML",!1,n)},uploadImage:function(){var e=r()(n.a.mark(function e(t,s,i){return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.$store.dispatch(p.H,{file:t,path:s,id:i}),this.$store.state.chat.fileCount,e.next=4,this.$store.state.chat.images[i];case 4:this.imgURL=e.sent,console.log(this.imgURL);case 6:case"end":return e.stop()}},e,this)}));return function(t,s,i){return e.apply(this,arguments)}}(),removeImage:function(e){this.images.splice(e,1),this.realImage.splice(e,1),window.URL.revokeObjectURL(this.realImage.splice(e,1)),this.paths.splice(e,1),0==this.images.length&&(this.hasImage=!1)},removeFile:function(e){this.filePaths.splice(e,1),this.realFile.splice(e,1),0==this.files.length&&(this.hasFile=!1)},oversize:function(e,t){this.$modal.show("dialog",{title:e,text:t,buttons:[{title:"CLOSE",default:!1}]})},send:function(){var e=this;if(this.message=document.getElementById("comment").textContent,this.message.length>this.messageLimit)vm.oversize("YOUR MESSAGE IS TOO LONG","Please make your message shorter. Limit is 1000 characters");else{if(0==this.message.length&&0==this.imgURL.length)return;var t={message:this.message,owner:this.userInfo.name,ownerId:this.userInfo._id,_id:this.messages.id,userImg:this.userInfo.imgURL,img:this.imgURLs,file:this.files,groupId:this.messages.groupId};this.$store.dispatch(p.C,t).then(function(){e.$store.dispatch("resetImage"),document.getElementById("comment").innerHTML="",e.images=[],e.files=[],e.paths=[],e.filePaths=[],e.hasImage=!1,e.hasFile=!1,e.realFile=[],e.realImage=[],e.imgURL=[]})}},sendMessage:function(e){this.$store.dispatch("resetImage");e.preventDefault();var t=this.messages.groupId;if(this.emo&&this.searchEmoji(e),this.hasFile)for(var s=this.filePaths.length-1,i=0;i<=s;i++)this.uploadFile(this.realFile[i],this.filePaths[i],t);if(this.realImage.length)for(var n=this.paths.length,o=0;o<n;o++)this.uploadImage(this.realImage[o],this.paths[o],t)},loadOldMessage:function(e){var t=e.target.scrollTop,s=this.messages.groupId;t<100&&Date.now()-this.now>2e3&&this.isScrollable&&(this.now=Date.now(),this.isScrollable=!1,this.limitMessage+=10,this.getOldMessage(s))},scrollChat:function(){var e=this;this.isScrollable=!1,window.setTimeout(function(){var t=document.getElementById("main-messages");t&&(t.scrollTop=t.scrollHeight),e.isScrollable=!0},100)},setCaret:function(){setTimeout(function(){var e=document.getElementById("comment"),t=document.createRange(),s=window.getSelection();e&&""!=e.innerHTML&&(t.setStart(e.childNodes[e.childNodes.length-1],e.childNodes[e.childNodes.length-1].length),t.collapse(!0),s.removeAllRanges(),s.addRange(t),e.focus())},200)},dragEnter:function(e){document.getElementById("dropzone").classList.add("border-primary")},dragLeave:function(e){document.getElementById("dropzone").classList.remove("border-primary")},checkImageLink:function(e){var t=e.indexOf(".jpg"),s=e.indexOf(".png"),i=e.indexOf(".jpeg");return t>-1||s>-1||i>-1},getOldMessage:function(e){var t=this;g.a.collection("message").where("groupId","==",e).where("createdTime","<",this.now).orderBy("createdTime","desc").limit(this.limitMessage).get().then(function(e){var s=[];console.log(e),e.empty?(console.log({empty:!0}),t.oldMessages=[]):(e.forEach(function(e){s.push(e.data())}),console.log(s),t.oldMessages=s)}),this.isScrollable=!0},getNewMessage:function(e){var t=this;this.unsub=g.a.collection("message").where("groupId","==",e).where("createdTime",">",this.now).orderBy("createdTime","desc").onSnapshot(function(e){var s=[];console.log(e),e.empty?(console.log({empty:!0}),t.newMessages=[]):(e.forEach(function(e){s.push(e.data())}),console.log(s),t.newMessages=s,t.scrollChat())})},closeUserList:function(){this.isMobile&&document.getElementById("userList")&&"0px"==$("#userList").css("right")&&(document.getElementById("userList").style.right="-100%")}},mounted:function(){var e=this,t=this.$route.params.id;console.log(t),this.getOldMessage(t),this.getNewMessage(t);var s=this;setTimeout(function(){s.scrollChat()},100),Object(v.h)(document.getElementById("group-messages"),function(e){"right"==e?"0px"!=document.getElementById("listChat").style.left&&document.getElementById("userList")&&"0px"!=$("#userList").css("right")?document.getElementById("listChat").style.left="0":"0px"==document.getElementById("userList").style.right&&(document.getElementById("userList").style.right="-100%"):"left"==e&&document.getElementById("userList")&&"0px"!=$("#userList").css("right")&&(document.getElementById("userList").style.right="0")}),this.id=this.$route.params.id,this.messages=this.joinedGroupList.filter(function(t){return t.groupId==e.id})[0]||{}}},_={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"container-fluid main p-0",class:[e.isMobile?"full-size":"row m-0"]},[s("div",{staticClass:"d-flex align-items-end card border-0 p-0",class:[e.isMobile?"":"col-10"],staticStyle:{height:"100%"}},[s("div",{staticClass:"container-fluid card-body p-0",staticStyle:{height:"calc(100vh - 56px - 64px)"}},[s("ul",{staticClass:"list-group list-group-flush d-flex flex-column-reverse main-message",staticStyle:{"overflow-x":"hidden","padding-bottom":"20px"},attrs:{id:"group-messages"},on:{click:function(t){return e.closeUserList()}}},[e._l(e.newMessages,function(t,i){return s("a",{key:t.createdTime,staticClass:"list-group-item px-4 py-1",staticStyle:{border:"none"}},[s("ChatMessage",{attrs:{c:t,next:e.newMessages[i+1]}})],1)}),e._v(" "),e.oldMessages?e._e():s("hr",{staticClass:"m-1"}),e._v(" "),e._l(e.oldMessages,function(t,i){return s("a",{key:t.createdTime,staticClass:"list-group-item px-4 py-1",staticStyle:{border:"none"}},[s("ChatMessage",{attrs:{c:t,next:e.oldMessages[i+1]}})],1)})],2)]),e._v(" "),s("div",{staticClass:"container-fluid card-footer",staticStyle:{position:"relative"}},[e.images.length?s("div",{staticClass:"images-preview d-flex justify-content-center bg-light p-2"},e._l(e.images,function(t,i){return s("div",{key:i,staticClass:"image_preview border mx-1",style:"background-image: url("+t+")"},[s("i",{staticClass:"fas fa-lg fa-times-circle bg-white rounded-circle text-dark",staticStyle:{position:"absolute",top:"5px",right:"5px",cursor:"pointer",display:"none"},on:{click:function(t){return e.removeImage(i)}}})])}),0):e._e(),e._v(" "),s("div",{staticClass:"input-group"},[s("div",{staticClass:"input-group-prepend border"},[s("label",{staticClass:"btn btn-primary m-0"},[s("i",{staticClass:"far fa-plus-square fa-lg fa-2x",staticStyle:{"vertical-align":"top"}}),e._v(" "),s("input",{staticStyle:{visibility:"hidden",display:"none"},attrs:{type:"file",id:"inputImage",multiple:""},on:{change:function(t){return e.chooseImage(t)}}})])]),e._v(" "),s("div",{staticClass:"p-2 border-top message form-control",class:{minimize:e.minimize},staticStyle:{"max-height":"42px","overflow-y":"auto"},attrs:{contenteditable:"true",id:"comment"},on:{keyup:[function(t){return t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:e.searchEmoji(t)},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:e.sendMessage(t)}],paste:function(t){return e.pasteImage(t)}}}),e._v(" "),s("div",{staticClass:"input-group-append border"},[s("button",{staticClass:"btn btn-primary m-0",attrs:{type:"button"},on:{click:function(t){e.emojiPicker=!e.emojiPicker}}},[s("img",{staticClass:"emoji",staticStyle:{height:"1.5em"},attrs:{src:"https://twemoji.maxcdn.com/2/72x72/1f600.png"}})]),e._v(" "),s("button",{staticClass:"btn btn-danger m-0",attrs:{type:"button"},on:{click:function(t){return e.sendMessage(t)}}},[s("i",{staticClass:"fas fa-reply"})])])])])]),e._v(" "),s("UserList",{class:[e.isMobile?"p-0":"col-2 p-0"]}),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:e.emojiPicker,expression:"emojiPicker"}],staticClass:"emoji-picker"},[s("Picker",{style:{position:"absolute",bottom:e.isMobile?"68px":"124px",right:e.isMobile?"0":"17%",width:e.isMobile?"100vw":"50vw",zIndex:300},attrs:{set:"twitter",native:!1,emojiTooltip:!e.isMobile,showPreview:!e.isMobile},on:{select:function(t){return e.selectEmoji(t)}}})],1)],1)},staticRenderFns:[]};var C=s("VU/8")(L,_,!1,function(e){s("qA4w")},"data-v-59bc9faf",null);t.default=C.exports},eKXm:function(e,t){},qA4w:function(e,t){}});
//# sourceMappingURL=3.3205706d9b13e52777d5.js.map