webpackJsonp([3],{"9r0o":function(t,e,i){"use strict";var o=i("Zrlr"),n=i.n(o),s=i("yp89");e.a=function t(e){n()(this,t),this.id=Object(s.a)(),this.order_id=e.order_id,this.ticket_id=e.ticket_id,this.items=[],this.total=e.total||this.items?+this.items.reduce(function(t,e){return+t+ +e.final_price*+e.quantity},0):0,this.created_time=Date.now(),this.completed_time=null,this.is_done=!1,this.type=e.type}},Tj1n:function(t,e){},VaM0:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i("BO1k"),n=i.n(o),s=i("woOf"),a=i.n(s),c=i("Dd8w"),r=i.n(c),l=i("r5kb"),d=r()({confirmItemTicket:function(t){this.firebaseDB.collection(this.collection).doc(t).update({confirmed:!0})},createBill:function(t,e){var i=a()({},t);return this.create(i,e),this},getReport:function(t,e){this.firebaseDB.collection(this.collection).where("type","==",t).get().then(function(t){if(!t.empty){var i=[];t.forEach(function(t){i.push(t.data())}),e(i)}})}},l.a),m=i("N+h9"),_=(i("9r0o"),i("kxiW"),{name:"Storage",data:function(){return{ticket:[],importTicket:[],order:"",items:[],item:{},searchID:"",searchID2:""}},methods:{update:function(){this.item.stock=+this.item.stock,this.item.price=+this.item.price,saleManage.setFirebaseDB(m.a).setCollection("items").update(this.item._id,this.item)},fetchOrder:function(t,e){this.item=this.items[e]},fetchImportOrder:function(t,e){var i=this;d.setCollection("ImportOrder").getWithCondition([{field:"id",op:"==",value:t}],function(t){i.order=t[0],console.log(t)})},confirmTicket:function(t){var e=0,i=function(i){if("combo"==i.type){var o=function(t){d.setCollection("items").get(t._id,function(e){d.setCollection("items").update(t._id,{stock:+e.stock-+i.quantity})})},s=!0,a=!1,c=void 0;try{for(var r,l=n()(i.itemsList);!(s=(r=l.next()).done);s=!0){o(r.value)}}catch(t){a=!0,c=t}finally{try{!s&&l.return&&l.return()}finally{if(a)throw c}}var m=+i.price*+i.quantity;e+=m}"item"==i.type&&d.setCollection("items").get(i._id,function(t){d.setCollection("items").update(i._id,{stock:+t.stock-+i.quantity})});var _=(+i.price-+i.discount_value||0)*(100-+i.discount_percent||0)/100*+i.quantity;t.items.total=_,e+=_},o=!0,s=!1,a=void 0;try{for(var c,r=n()(t.items);!(o=(c=r.next()).done);o=!0){i(c.value)}}catch(t){s=!0,a=t}finally{try{!o&&r.return&&r.return()}finally{if(s)throw a}}d.setCollection("tickets").update(t._id,{is_confirmed:!0,completed_time:Date.now()}),d.setCollection("orders").getWithCondition([{field:"id",op:"==",value:t.order_id}],function(t){d.setCollection("orders").update(t[0]._id,{is_done:!0,completed_time:Date.now()})}),d.setCollection("bills").getWithCondition([{field:"ticket_id",op:"==",value:t.id}],function(i){d.setCollection("bills").update(i[0]._id,{is_done:!0,completed_time:Date.now(),total:e.toFixed(6),items:t.items})});var m=(new Date).getMonth()+"_"+(new Date).getFullYear();l.a.setCollection("money").get(m,function(t){var i=0;t.money<0&&+t.money+ +e>0&&(i=Date.now()),l.a.setCollection("money").update(m,{money:+t.money+ +e,time:i}),t||l.a.setCollection("money").set(m,{money:+-item.total})})},rejectTicket:function(t){var e=0,i=function(i){if("combo"==i.type){var o=function(t){d.setCollection("items").get(t._id,function(e){d.setCollection("items").update(t._id,{stock:+e.stock-+i.quantity})})},s=!0,a=!1,c=void 0;try{for(var r,l=n()(i.itemsList);!(s=(r=l.next()).done);s=!0){o(r.value)}}catch(t){a=!0,c=t}finally{try{!s&&l.return&&l.return()}finally{if(a)throw c}}var m=+i.price*+i.quantity;e+=m}"item"==i.type&&d.setCollection("items").get(i._id,function(t){d.setCollection("items").update(i._id,{stock:+t.stock-+i.quantity})});var _=(+i.price-+i.discount_value||0)*(100-+i.discount_percent||0)/100*+i.quantity;t.items.total=_,e+=_},o=!0,s=!1,a=void 0;try{for(var c,r=n()(t.items);!(o=(c=r.next()).done);o=!0){i(c.value)}}catch(t){s=!0,a=t}finally{try{!o&&r.return&&r.return()}finally{if(s)throw a}}d.setCollection("tickets").update(t._id,{is_confirmed:!1,completed_time:Date.now()}),d.setCollection("orders").getWithCondition([{field:"id",op:"==",value:t.order_id}],function(t){d.setCollection("orders").update(t[0]._id,{is_done:!1,completed_time:Date.now()})}),d.setCollection("bills").getWithCondition([{field:"ticket_id",op:"==",value:t.id}],function(t){console.log(t),d.setCollection("bills").update(t[0]._id,{is_done:!1,completed_time:Date.now()})});var m=function(t){if("combo"==t.type){var e=function(e){d.setCollection("items").get(e._id,function(i){d.setCollection("items").update(e._id,{stock:+i.stock+ +t.quantity})})},i=!0,o=!1,s=void 0;try{for(var a,c=n()(t.itemsList);!(i=(a=c.next()).done);i=!0){e(a.value)}}catch(t){o=!0,s=t}finally{try{!i&&c.return&&c.return()}finally{if(o)throw s}}}"item"==t.type&&d.setCollection("items").get(t._id,function(e){d.setCollection("items").update(t._id,{stock:+e.stock+ +t.quantity})})},_=!0,u=!1,v=void 0;try{for(var p,f=n()(t.items);!(_=(p=f.next()).done);_=!0){m(p.value)}}catch(t){u=!0,v=t}finally{try{!_&&f.return&&f.return()}finally{if(u)throw v}}var h=(new Date).getMonth()+"_"+(new Date).getFullYear();l.a.setCollection("money").get(h,function(t){var i=t.time;+t.money-+e<0&&(i=""),l.a.setCollection("money").update(h,{money:+t.money-+e,time:i}),t||l.a.setCollection("money").set(h,{money:+-item.total})})},confirmImportTicket:function(t){d.setCollection("ImportTicket").update(t._id,{is_confirmed:!0,completed_time:Date.now()}),d.setCollection("ImportOrder").getWithCondition([{field:"id",op:"==",value:t.order_id}],function(t){d.setCollection("ImportOrder").update(t[0]._id,{is_done:!0,completed_time:Date.now()})}),d.setCollection("ImportBill").getWithCondition([{field:"ticketid",op:"==",value:t.id}],function(t){console.log(t),d.setCollection("bills").update(t[0]._id,{is_done:!0,completed_time:Date.now()})});var e=function(t){if("combo"==t.type){var e=function(e){d.setCollection("items").get(e._id,function(i){d.setCollection("items").update(e._id,{stock:+i.stock-+t.quantity})})},i=!0,o=!1,s=void 0;try{for(var a,c=n()(t.itemsList);!(i=(a=c.next()).done);i=!0){e(a.value)}}catch(t){o=!0,s=t}finally{try{!i&&c.return&&c.return()}finally{if(o)throw s}}}"item"==t.type&&d.setCollection("items").get(t._id,function(e){d.setCollection("items").update(t._id,{stock:+e.stock-+t.quantity})})},i=!0,o=!1,s=void 0;try{for(var a,c=n()(t.items);!(i=(a=c.next()).done);i=!0){e(a.value)}}catch(t){o=!0,s=t}finally{try{!i&&c.return&&c.return()}finally{if(o)throw s}}},rejectImportTicket:function(t){d.setCollection("ImportTicket").update(t._id,{is_confirmed:!1,completed_time:Date.now()}),d.setCollection("ImportOrder").getWithCondition([{field:"id",op:"==",value:t.order_id}],function(t){d.setCollection("ImportOrder").update(t[0]._id,{is_done:!1,completed_time:Date.now()})}),d.setCollection("ImportBill").getWithCondition([{field:"ticketid",op:"==",value:t.id}],function(t){console.log(t),d.setCollection("bills").update(t[0]._id,{is_done:!1,completed_time:Date.now()})});var e=function(e){if("combo"==e.type){var i=function(t){d.setCollection("items").get(t._id,function(i){d.setCollection("items").update(t._id,{stock:+i.stock-+e.quantity})})},o=!0,s=!1,a=void 0;try{for(var c,r=n()(e.itemsList);!(o=(c=r.next()).done);o=!0){i(c.value)}}catch(t){s=!0,a=t}finally{try{!o&&r.return&&r.return()}finally{if(s)throw a}}}"item"==e.type&&d.setCollection("items").get(e._id,function(t){d.setCollection("items").update(e._id,{stock:+t.stock-+e.quantity})});var l=(+e.price-+e.discount_value)*(100-+e.discount_percent)/100*+e.quantity;t.items.total=l,total+=l},i=!0,o=!1,s=void 0;try{for(var a,c=n()(t.items);!(i=(a=c.next()).done);i=!0){e(a.value)}}catch(t){o=!0,s=t}finally{try{!i&&c.return&&c.return()}finally{if(o)throw s}}},search:function(){var t=this.searchID.toLowerCase();$("#export tbody tr").filter(function(){$(this).toggle($(this).text().toLowerCase().indexOf(t)>-1)})},search2:function(){var t=this.searchID2.toLowerCase();$("#import tbody tr").filter(function(){$(this).toggle($(this).text().toLowerCase().indexOf(t)>-1)})}},created:function(){var t=this;d.setFirebaseDB(m.a),d.setCollection("tickets").getWithConditionRealTime([{field:"type",op:"==",value:"export"}],function(e){t.ticket=e,console.log(e)}),d.setCollection("ImportTicket").setOrderBy("created_time","desc").getAllRealTime(function(e){"None"!=e&&(t.importTicket=e,console.log(e))}),d.setCollection("items").setOrderBy("created_time","desc").getAllRealTime(function(e){"None"!=e&&(t.items=e,console.log(e))})}}),u={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"container"},[t._m(0),t._v(" "),i("div",{staticClass:"tab-content mt-1"},[i("div",{staticClass:"container tab-pane active",attrs:{id:"export"}},[i("div",{staticClass:"form-group"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.searchID,expression:"searchID"}],staticClass:"form-control",attrs:{type:"text",placeholder:"Search"},domProps:{value:t.searchID},on:{keyup:function(e){t.search()},input:function(e){e.target.composing||(t.searchID=e.target.value)}}})]),t._v(" "),i("table",{staticClass:"table"},[t._m(1),t._v(" "),i("tbody",t._l(t.ticket,function(e,o){return i("tr",{key:o,attrs:{role:"button"}},[i("th",{attrs:{scope:"row"}},[t._v(t._s(o+1))]),t._v(" "),i("td",[t._v(t._s(e.id))]),t._v(" "),i("td",[t._v(t._s(new Date(e.created_time).toLocaleDateString()))]),t._v(" "),i("td",[t._v(t._s(new Date(e.completed_time).toLocaleDateString()))]),t._v(" "),i("td",[t._v(t._s(e.is_confirmed?"Done":"Pending"))]),t._v(" "),i("td",[i("button",{staticClass:"btn btn-primary",on:{click:function(i){t.fetchOrder(e.order_id,o)}}},[t._v("Detail")]),t._v(" "),e.is_confirmed?t._e():i("button",{staticClass:"btn btn-primary",on:{click:function(i){t.confirmTicket(e)}}},[t._v("Confirm")]),t._v(" "),e.is_confirmed?i("button",{staticClass:"btn btn-primary",on:{click:function(i){t.rejectTicket(e)}}},[t._v("Reject")]):t._e()])])}))]),t._v(" "),t.item?i("div",{staticClass:"card"},[i("div",{staticClass:"card-header"},[i("h3",[t._v("Order ID: "+t._s(t.item.id))])]),t._v(" "),i("div",{staticClass:"card-body"},[i("p",[t._v("Name: "+t._s(t.item.name))]),t._v(" "),i("p",[t._v("Date: "+t._s(t.item.created_time))]),t._v(" "),i("p",[t._v("Employee: "+t._s(t.item.employee_id))]),t._v(" "),i("p",[t._v("Status: "+t._s(t.item.is_done?"Done":"Pending"))]),t._v(" "),i("p",[i("a",{staticClass:"btn btn-primary",attrs:{"data-toggle":"collapse",href:"#"+t.item.id,role:"button","aria-expanded":"false","aria-controls":t.item.id}},[t._v("Items")])]),t._v(" "),i("div",{staticClass:"collapse",attrs:{id:t.item.id}},t._l(t.item.items,function(e,o){return i("div",{key:o,staticClass:"card card-body m-1"},[i("p",[t._v("ID: "+t._s(e.id))]),t._v(" "),i("p",[t._v("Name: "+t._s(e.name))]),t._v(" "),i("p",[t._v("Price: "+t._s(e.price))]),t._v(" "),i("p",[t._v("Discount percent: "+t._s(e.discount_percent)+"%")]),t._v(" "),i("p",[t._v("Discount value: "+t._s(e.discount_value))]),t._v(" "),i("p",[t._v("Quantity: "+t._s(e.quantity))]),t._v(" "),i("p",[t._v("Stock: "+t._s(e.stock))]),t._v(" "),i("p",[t._v("Added Time: "+t._s(e.created_time))]),t._v(" "),i("p",[t._v("Final price: "+t._s(e.final_price))]),t._v(" "),i("p",[t._v("Total: "+t._s(+e.final_price*+e.quantity))])])}))])]):t._e()]),t._v(" "),i("div",{staticClass:"container tab-pane",attrs:{id:"import"}},[i("div",{staticClass:"form-group"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.searchID2,expression:"searchID2"}],staticClass:"form-control",attrs:{type:"text",placeholder:"Search"},domProps:{value:t.searchID2},on:{keyup:function(e){t.search2()},input:function(e){e.target.composing||(t.searchID2=e.target.value)}}})]),t._v(" "),i("table",{staticClass:"table"},[t._m(2),t._v(" "),i("tbody",t._l(t.importTicket,function(e,o){return i("tr",{key:o,attrs:{role:"button"}},[i("th",{attrs:{scope:"row"}},[t._v(t._s(o+1))]),t._v(" "),i("td",[t._v(t._s(e.id))]),t._v(" "),i("td",[t._v(t._s(new Date(e.created_time).toLocaleDateString()))]),t._v(" "),i("td",[t._v(t._s(new Date(e.completed_time).toLocaleDateString()))]),t._v(" "),i("td",[t._v(t._s(e.is_confirmed))]),t._v(" "),i("td",[i("button",{staticClass:"btn btn-primary",on:{click:function(i){t.fetchImportOrder(e.order_id,o)}}},[t._v("Detail")]),t._v(" "),e.is_confirmed?t._e():i("button",{staticClass:"btn btn-primary",on:{click:function(i){t.confirmImportTicket(e)}}},[t._v("Confirm")]),t._v(" "),e.is_confirmed?i("button",{staticClass:"btn btn-primary",on:{click:function(i){t.rejectImportTicket(e)}}},[t._v("Reject")]):t._e()])])}))])]),t._v(" "),i("div",{staticClass:"container tab-pane",attrs:{id:"item-info"}},[i("table",{staticClass:"table"},[t._m(3),t._v(" "),i("tbody",t._l(t.items,function(e,o){return i("tr",{key:o,attrs:{role:"button"}},[i("th",{attrs:{scope:"row"}},[t._v(t._s(o+1))]),t._v(" "),i("td",[t._v(t._s(e.id))]),t._v(" "),i("td",[t._v(t._s(e.name))]),t._v(" "),i("td",[t._v(t._s(e.price))]),t._v(" "),i("td",[t._v(t._s(e.stock))]),t._v(" "),i("td",[t._v(t._s(e.is_confirmed))]),t._v(" "),i("td",[i("button",{staticClass:"btn btn-primary",on:{click:function(i){t.fetchOrder(e.id,o)}}},[t._v("Detail")])])])}))]),t._v(" "),i("div",{staticClass:"card container"},[i("h4",[t._v("Update item")]),t._v(" "),i("div",{staticClass:"form-group"},[i("label",{staticClass:"col-md-4 control-label",attrs:{for:"textinput"}},[t._v("product name")]),t._v(" "),i("div",{staticClass:"col-md-4"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.item.name,expression:"item.name"}],staticClass:"form-control input-md",attrs:{id:"textinput",name:"textinput",type:"text",placeholder:""},domProps:{value:t.item.name},on:{input:function(e){e.target.composing||t.$set(t.item,"name",e.target.value)}}})])]),t._v(" "),i("div",{staticClass:"form-group"},[i("label",{staticClass:"col-md-4 control-label",attrs:{for:"textinput"}},[t._v("price - unit")]),t._v(" "),i("div",{staticClass:"col-md-4"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.item.price,expression:"item.price"}],staticClass:"form-control input-md",attrs:{id:"textinput",name:"textinput",type:"number",placeholder:""},domProps:{value:t.item.price},on:{input:function(e){e.target.composing||t.$set(t.item,"price",e.target.value)}}})])]),t._v(" "),i("div",{staticClass:"form-group"},[i("label",{staticClass:"col-md-4 control-label",attrs:{for:"textinput"}},[t._v("stock")]),t._v(" "),i("div",{staticClass:"col-md-4"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.item.stock,expression:"item.stock"}],staticClass:"form-control input-md",attrs:{id:"textinput",name:"textinput",type:"number",placeholder:""},domProps:{value:t.item.stock},on:{input:function(e){e.target.composing||t.$set(t.item,"stock",e.target.value)}}})])]),t._v(" "),i("div",{staticClass:"form-group"},[i("label",{staticClass:"col-md-4 control-label",attrs:{for:"singlebutton"}}),t._v(" "),i("div",{staticClass:"col-md-4"},[i("button",{staticClass:"btn btn-success",attrs:{id:"singlebutton",name:"singlebutton"},on:{click:function(e){t.update()}}},[t._v("Update")])])])])])])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("ul",{staticClass:"nav nav-tabs"},[e("li",{staticClass:"nav-item"},[e("a",{staticClass:"nav-link active",attrs:{"data-toggle":"tab",href:"#export"}},[this._v("Export Tickets")])]),this._v(" "),e("li",{staticClass:"nav-item"},[e("a",{staticClass:"nav-link",attrs:{"data-toggle":"tab",href:"#import"}},[this._v("Import Tickets")])]),this._v(" "),e("li",{staticClass:"nav-item"},[e("a",{staticClass:"nav-link",attrs:{"data-toggle":"tab",href:"#item-info"}},[this._v("Item Info")])])])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("thead",{staticClass:"thead-dark"},[i("tr",[i("th",{attrs:{scope:"col"}},[t._v("#")]),t._v(" "),i("th",{attrs:{scope:"col"}},[t._v("ID")]),t._v(" "),i("th",{attrs:{scope:"col"}},[t._v("Created Date")]),t._v(" "),i("th",{attrs:{scope:"col"}},[t._v("Completed Date")]),t._v(" "),i("th",{attrs:{scope:"col"}},[t._v("Status")]),t._v(" "),i("th",{attrs:{scope:"col"}})])])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("thead",{staticClass:"thead-dark"},[i("tr",[i("th",{attrs:{scope:"col"}},[t._v("#")]),t._v(" "),i("th",{attrs:{scope:"col"}},[t._v("ID")]),t._v(" "),i("th",{attrs:{scope:"col"}},[t._v("Created Date")]),t._v(" "),i("th",{attrs:{scope:"col"}},[t._v("Completed Date")]),t._v(" "),i("th",{attrs:{scope:"col"}},[t._v("Status")]),t._v(" "),i("th",{attrs:{scope:"col"}})])])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("thead",{staticClass:"thead-dark"},[i("tr",[i("th",{attrs:{scope:"col"}},[t._v("#")]),t._v(" "),i("th",{attrs:{scope:"col"}},[t._v("ID")]),t._v(" "),i("th",{attrs:{scope:"col"}},[t._v("Name")]),t._v(" "),i("th",{attrs:{scope:"col"}},[t._v("Price")]),t._v(" "),i("th",{attrs:{scope:"col"}},[t._v("Stock")]),t._v(" "),i("th",{attrs:{scope:"col"}})])])}]};var v=i("VU/8")(_,u,!1,function(t){i("Tj1n")},null,null);e.default=v.exports}});
//# sourceMappingURL=3.40269aad8898b1fcd407.js.map