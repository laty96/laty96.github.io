webpackJsonp([2],{FbxS:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s("woOf"),a=s.n(i),n=s("Xxa5"),o=s.n(n),r=s("exGp"),l=s.n(r),c=s("Dd8w"),h=s.n(c),m=s("bOdI"),u=s.n(m),g=s("KMaP"),d=(s("PJh5"),s("Hvsy")),f=(s("Qfbh"),s("lHQJ")),p=s("NYxO"),v=s("yp89"),y=s("P9fp"),w={name:"Group",components:{Picker:g.Picker,ChatMessage:y.a},data:function(){return u()({messages:{},groupId:this.$route.params.id,chat:[],minimize:!1,isFocus:!0,message:"",newMessages:[],oldMessages:[],emojiPicker:!1,emojiRegex:/(:[^\s]*(?:::[^:\s]*)*[^:\s]:)|(:[^\s]*(?:::[^:\s]*)*[^:\s])/g,emojiRegex2:/:\w{2,}:/g,matchesEmoji:[],emo:"",images:[],files:[],canSendMessage:!0,hasImage:!1,hasFile:!1,paths:[],filePaths:[],realImage:[],realFile:[],limitFiles:10,converlength:0,isScrollable:!1,now:0,limitMessage:10},"now",Date.now())},computed:h()({},Object(p.c)({userInfo:function(e){return e.auth.userInfo},getUserStatus:function(e){return e.auth.userInfo.status},getUsername:function(e){return e.auth.userInfo.name},notify:function(e){return e.auth.notify?e.auth.notify:[]},inactiveNotify:function(e){return e.auth.inactiveNoti?e.auth.inactiveNoti:[]},pendingRequests:function(e){return e.auth.pendingRequests},friendNotify:function(e){return e.auth.friendNotify},groupMessage:function(e){return e.group.groupMessage}})),watch:{id:function(){},$route:function(e){var t=this.$route.params.id;this.groupId=t,this.getOldMessage(t),this.getNewMessage(t)}},methods:{calendarTime:v.b,selectEmoji:function(e){document.getElementById("comment").innerHTML+=twemoji.parse(twemoji.convert.fromCodePoint(e.unified))+'<div style="display: none">'+e.colons+"</div>",this.emojiPicker=!1,this.setCaret()},searchEmoji:function(e){if(this.message=document.getElementById("comment").innerText,this.message.length>2&&32==e.keyCode||13==e.keyCode){this.emo=this.message.match(this.emojiRegex);var t=this.emo?this.emo[this.emo.length-1].substr(1):"";t.length>1&&(this.matchesEmoji=g.emojiIndex.search(t).map(function(e){return e}),this.replaceEmoji())}},replaceEmoji:function(e){var t=document.getElementById("comment");if(e){this.message=t.innerHTML;var s=twemoji.parse(twemoji.convert.fromCodePoint(e.unified));t.innerHTML=this.message.replace(this.emo,s+'<div style="display: none">'+e.colons+"</div>"),this.setCaret(),this.matchesEmoji=[],this.emo=[]}else if(this.matchesEmoji.length){this.message=t.innerHTML;var i=twemoji.parse(twemoji.convert.fromCodePoint(this.matchesEmoji[0].unified));t.innerHTML=this.message.replace(this.emo,i+'<div style="display: none">'+this.matchesEmoji[0].colons+"</div>"),this.setCaret(),this.matchesEmoji=[],this.emo=[]}},dropImage:function(e){e.preventDefault(),e.stopPropagation();var t=e.dataTransfer.files;if(t.length){t.length>=this.limitFiles&&alert("Limit"+this.limitFiles+"files");for(var s=0;s<t.length;s++)if("image/jpeg"!=t[s].type&&"image/png"!=t[s].type){var i=this.messages.groupId+"/"+Date.now()+"_"+t[s].name;this.canSendMessage=!1,this.hasFile=!0,this.filePaths.push(i),this.realFile.push(t[s])}else if("image/jpeg"==t[s].type||"image/png"==t[s].type){this.canSendMessage=!1,this.hasImage=!0;var a=this.messages.groupId+"/"+Date.now()+"_"+t[s].name;this.paths.push(a),this.images.push(window.URL.createObjectURL(t[s])),this.realImage.push(t[s])}}this.dragLeave(e)},uploadFile:function(){var e=l()(o.a.mark(function e(t,s,i){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.$store.dispatch(f.i,{file:t,path:s,id:i}),e.next=3,this.$store.state.chat.files[i];case 3:return this.files=e.sent,e.next=6,this.$store.state.chat.fileCount;case 6:e.sent,console.log(this.files);case 8:case"end":return e.stop()}},e,this)}));return function(t,s,i){return e.apply(this,arguments)}}(),pasteImage:function(e){this.messages.id;var t=e.clipboardData.files;if(t.length&&!(this.images.length>7)){this.hasImage=!0;var s=this.messages.groupId+"/"+Date.now()+t[0].name;this.paths.push(s),this.images.push(window.URL.createObjectURL(t[0])),this.realImage.push(t[0]),this.$forceUpdate(),e.preventDefault();var i=(e.originalEvent||e).clipboardData.getData("text/plain");document.execCommand("insertHTML",!1,i)}},uploadImage:function(){var e=l()(o.a.mark(function e(t,s,i){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.$store.dispatch(f.H,{file:t,path:s,id:i}),this.$store.state.chat.fileCount,e.next=4,this.$store.state.chat.images[i];case 4:this.images=e.sent,console.log(this.images);case 6:case"end":return e.stop()}},e,this)}));return function(t,s,i){return e.apply(this,arguments)}}(),removeImage:function(e){this.images.splice(e,1),this.paths.splice(e,1),0==this.images.length&&(this.hasImage=!1)},removeFile:function(e){this.filePaths.splice(e,1),this.realFile.splice(e,1),0==this.files.length&&(this.hasFile=!1)},show:function(e,t){this.$modal.show({template:'<div><div><img id="imageShow" src="'+e+'" style="width: 100%"/><button class="close" @click="$emit(\'close\')" style="position: absolute;right: 20px;top: 10px;">&times;</button></div>\n\t\t\t\t\t\t\t\t\t\t\t<div style="background-color: transparent;" class="d-flex justify-content-center mt-2">\n\t\t\t\t\t\t\t\t\t\t\t\t<div v-for="image in images" :style="{backgroundImage: \'url(\'+image+\')\'}" @click="showImage(image)" :class="{active: active == image}" id="thumbnailImage" class="border border-dark"></div></div></div>',props:{images:Array},data:function(){return{active:e}},methods:{showImage:function(e){document.getElementById("imageShow").src!=e&&(document.getElementById("imageShow").src=e),this.active=e}},mounted:function(){document.getElementsByTagName("body")[0].style.overflow="hidden"},destroyed:function(){document.getElementsByTagName("body")[0].style.overflow=""}},{images:t},{width:"70%",height:"auto",style:{"z-index":9e3}},{closed:this.hide})},hide:function(){this.$modal.hide("view-post")},sendMessage:function(e){var t=this;if(e.preventDefault(),this.emo&&this.searchEmoji(e),this.hasFile)for(var s=this.filePaths.length-1,i=0;i<=s;i++)this.uploadFile(this.realFile[i],this.filePaths[i],id);if(this.hasImage)for(var n=this.paths.length-1,o=0;o<=n;o++)this.uploadImage(this.realImage[o],this.paths[o],id);if(this.message=document.getElementById("comment").textContent,this.message.length>1e3)return this.$modal.show("dialog",{text:"Please make your message shorter. Limit is 1,000 characters",title:"YOUR MESSAGE IS TOO LONG"}),void alert(12214);if(this.message){var r={message:this.message,owner:this.userInfo.name,ownerId:this.userInfo._id,userImg:this.userInfo.imgURL,img:this.images,file:this.files,groupId:this.groupId};this.$store.dispatch(f.C,r).then(this.scrollChat()),document.getElementById("comment").innerHTML="",this.images=[],this.files=[],this.paths=[],this.filePaths=[],this.hasImage=!1,this.hasFile=!1,this.realFile=[],this.realImage=[],setTimeout(function(){console.log(t.$store.state.chat.newMessage),t.$forceUpdate(),t.scrollChat()},10),this.newMessages=a()(this.newMessages,this.$store.state.chat.newMessage)}},loadOldMessage:function(e){var t=e.target.scrollTop,s=this.messages.groupId;t<100&&Date.now()-this.now>2e3&&this.isScrollable&&(this.now=Date.now(),this.isScrollable=!1,this.limitMessage+=10,this.getOldMessage(s))},scrollChat:function(){var e=this;this.isScrollable=!1,window.setTimeout(function(){var t=document.getElementById("main-messages");t&&(t.scrollTop=t.scrollHeight),e.isScrollable=!0},100)},setCaret:function(){setTimeout(function(){var e=document.getElementById("comment"),t=document.createRange(),s=window.getSelection();e&&""!=e.innerHTML&&(t.setStart(e.childNodes[e.childNodes.length-1],e.childNodes[e.childNodes.length-1].length),t.collapse(!0),s.removeAllRanges(),s.addRange(t),e.focus())},200)},dragEnter:function(e){document.getElementById("dropzone").classList.add("border-primary")},dragLeave:function(e){document.getElementById("dropzone").classList.remove("border-primary")},checkImageLink:function(e){var t=e.indexOf(".jpg"),s=e.indexOf(".png"),i=e.indexOf(".jpeg");return t>-1||s>-1||i>-1},getOldMessage:function(e){var t=this;d.a.collection("message").where("groupId","==",e).where("createdTime","<",this.now).orderBy("createdTime","desc").limit(this.limitMessage).get().then(function(e){var s=[];console.log(e),e.empty?(console.log({empty:!0}),t.oldMessages=[]):(e.forEach(function(e){s.push(e.data())}),console.log(s),t.oldMessages=s)}),this.isScrollable=!0},getNewMessage:function(e){var t=this;this.unsub=d.a.collection("message").where("groupId","==",e).where("createdTime",">",this.now).orderBy("createdTime","desc").onSnapshot(function(e){var s=[];console.log(e),e.empty?(console.log({empty:!0}),t.newMessages=[]):(e.forEach(function(e){s.push(e.data())}),console.log(s),t.newMessages=s,t.scrollChat())})}},mounted:function(){var e=this.$route.params.id;console.log(e),this.getOldMessage(e),this.getNewMessage(e);var t=this;setTimeout(function(){t.scrollChat()},100)}},I={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"container-fluid main p-0"},[s("div",{staticClass:"container-fluid bg-light d-flex align-items-end card border-0 p-0",staticStyle:{height:"100%"}},[s("div",{staticClass:"container-fluid card-body p-0"},[s("ul",{staticClass:"list-group list-group-flush d-flex flex-column-reverse main-message",attrs:{id:"main-messages"}},[e._l(e.newMessages,function(t){return s("a",{key:t.createdTime,staticClass:"list-group-item px-4 py-1"},[s("ChatMessage",{attrs:{c:t}}),e._v(" "),s("hr",{staticClass:"m-1"})],1)}),e._v(" "),e._l(e.oldMessages,function(t){return s("a",{key:t.createdTime,staticClass:"list-group-item px-4 py-1"},[s("ChatMessage",{attrs:{c:t}}),e._v(" "),s("hr",{staticClass:"m-1"})],1)})],2)]),e._v(" "),s("div",{staticClass:"container-fluid card-footer"},[s("div",{staticClass:"input-group"},[e._m(0),e._v(" "),s("div",{staticClass:"p-2 border-top message form-control",class:{minimize:e.minimize},staticStyle:{"max-height":"100px","overflow-y":"auto"},attrs:{contenteditable:"true",id:"comment"},on:{keyup:[function(t){return t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:e.searchEmoji(t)},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:e.sendMessage(t)}],paste:function(t){return e.pasteImage(t)}}}),e._v(" "),s("div",{staticClass:"input-group-append"},[s("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:function(t){e.emojiPicker=!e.emojiPicker}}},[s("img",{staticClass:"emoji",staticStyle:{height:"1.5em"},attrs:{src:"https://twemoji.maxcdn.com/2/72x72/1f600.png"}})]),e._v(" "),s("button",{staticClass:"btn btn-danger",attrs:{type:"button"},on:{click:function(t){return e.sendMessage()}}},[s("i",{staticClass:"fas fa-reply"})])])])])]),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:e.emojiPicker,expression:"emojiPicker"}],staticClass:"emoji-picker"},[s("Picker",{style:{position:"absolute",bottom:"127px",right:"0",width:"50vw",zIndex:300},attrs:{set:"twitter",native:!1,emojiTooltip:!0,showPreview:!1},on:{select:function(t){return e.selectEmoji(t)}}})],1)])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"input-group-prepend"},[t("button",{staticClass:"btn btn-primary"},[this._v("Default")])])}]};var b=s("VU/8")(w,I,!1,function(e){s("zR7y")},"data-v-79594423",null);t.default=b.exports},zR7y:function(e,t){}});
//# sourceMappingURL=2.22e978571fac8411d815.js.map